<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Federal Reserve Rate Monitor - Smart Contract Oracle Demo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 900px;
            width: 100%;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .oracle-badge {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            padding: 5px 15px;
            border-radius: 20px;
            margin-top: 10px;
            font-size: 12px;
            font-weight: 600;
            letter-spacing: 1px;
        }

        .content {
            padding: 40px;
        }

        .rate-display {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        .rate-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .rate-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, transparent 70%);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .rate-card.primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .rate-label {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 2px;
            opacity: 0.8;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .rate-value {
            font-size: 48px;
            font-weight: bold;
            line-height: 1;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }

        .rate-value .percent {
            font-size: 24px;
            opacity: 0.9;
        }

        .rate-timestamp {
            font-size: 11px;
            opacity: 0.7;
            margin-top: 10px;
            line-height: 1.4;
        }

        .change-indicator {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            margin-top: 10px;
        }

        .change-indicator.increase {
            background: rgba(239, 68, 68, 0.2);
            color: #dc2626;
        }

        .change-indicator.decrease {
            background: rgba(34, 197, 94, 0.2);
            color: #16a34a;
        }

        .change-indicator.unchanged {
            background: rgba(107, 114, 128, 0.2);
            color: #6b7280;
        }

        .change-details {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .change-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .change-item {
            display: flex;
            flex-direction: column;
        }

        .change-label {
            font-size: 11px;
            text-transform: uppercase;
            color: #6b7280;
            letter-spacing: 1px;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .change-value {
            font-size: 20px;
            font-weight: 600;
            color: #1f2937;
        }

        .change-value.positive {
            color: #dc2626;
        }

        .change-value.negative {
            color: #16a34a;
        }

        .change-value.neutral {
            color: #6b7280;
        }

        .history-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border-bottom: 1px solid #e5e7eb;
        }

        .history-item:last-child {
            border-bottom: none;
        }

        .history-date {
            font-size: 13px;
            color: #6b7280;
        }

        .history-rate {
            font-size: 16px;
            font-weight: 600;
            color: #1f2937;
        }

        .history-change {
            font-size: 14px;
            font-weight: 500;
        }

        .info-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .info-item {
            display: flex;
            flex-direction: column;
        }

        .info-label {
            font-size: 11px;
            text-transform: uppercase;
            color: #6b7280;
            letter-spacing: 1px;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .info-value {
            font-size: 16px;
            font-weight: 600;
            color: #1f2937;
        }

        .json-link {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            color: white;
            padding: 12px 24px;
            border-radius: 10px;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-top: 20px;
        }

        .json-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.4);
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #10b981;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .status-text {
            font-size: 14px;
            color: #374151;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #6b7280;
        }

        .error {
            background: #fee;
            color: #c00;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }

        .refresh-info {
            text-align: center;
            margin-top: 20px;
            font-size: 12px;
            color: #6b7280;
        }

        .last-update {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 5px;
            margin-top: 10px;
            font-size: 13px;
            color: #4b5563;
        }

        @media (max-width: 640px) {
            .rate-display {
                grid-template-columns: 1fr;
            }
            
            .rate-card.primary {
                transform: scale(1);
            }
            
            .rate-value {
                font-size: 36px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèõÔ∏è Federal Reserve Rate Monitor</h1>
            <p>Real-Time Oracle Data Source for Smart Contracts</p>
            <div class="oracle-badge">BLOCKCHAIN ORACLE</div>
        </div>
        
        <div class="content">
            <div class="status-indicator">
                <div class="status-dot"></div>
                <div class="status-text">
                    <strong>Live Data Feed</strong> - Smart Contract Oracle Active
                </div>
            </div>

            <div id="loading" class="loading">
                Loading Fed rate data...
            </div>

            <div id="error" class="error" style="display: none;">
                Failed to load data. Please check the JSON file.
            </div>

            <div id="rateContainer" style="display: none;">
                <div class="rate-display">
                    <div class="rate-card primary">
                        <div class="rate-label">Current Fed Rate</div>
                        <div class="rate-value">
                            <span id="currentRate">--</span><span class="percent">%</span>
                        </div>
                        <div id="changeIndicator" class="change-indicator unchanged">
                            <span id="changeArrow">‚Üí</span>
                            <span id="changeText">No Change</span>
                        </div>
                        <div class="rate-timestamp" id="currentTimestamp">--</div>
                    </div>
                    
                    <div class="rate-card">
                        <div class="rate-label">Previous Rate</div>
                        <div class="rate-value">
                            <span id="previousRate">--</span><span class="percent">%</span>
                        </div>
                        <div class="rate-timestamp" id="previousTimestamp">--</div>
                    </div>
                </div>

                <div class="change-details">
                    <h3 style="margin-bottom: 15px; color: #1f2937;">üìä Rate Change Analysis</h3>
                    <div class="change-grid">
                        <div class="change-item">
                            <div class="change-label">Basis Points Change</div>
                            <div class="change-value" id="bpsChange">--</div>
                        </div>
                        <div class="change-item">
                            <div class="change-label">Percentage Change</div>
                            <div class="change-value" id="pctChange">--</div>
                        </div>
                        <div class="change-item">
                            <div class="change-label">Time Since Last Change</div>
                            <div class="change-value neutral" id="timeSinceChange">--</div>
                        </div>
                        <div class="change-item">
                            <div class="change-label">Direction</div>
                            <div class="change-value" id="direction">--</div>
                        </div>
                    </div>
                </div>

                <div class="history-section" id="historySection" style="display: none;">
                    <h3 style="margin-bottom: 15px; color: #1f2937;">üìà Rate History</h3>
                    <div id="historyList"></div>
                </div>

                <div class="info-section">
                    <h3 style="margin-bottom: 15px; color: #1f2937;">üîó Oracle Information</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">Baseline Rate</div>
                            <div class="info-value">4.50% (Jul 19, 2025)</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Last Oracle Update</div>
                            <div class="info-value" id="lastUpdate">--</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Data Source</div>
                            <div class="info-value">JSON Oracle Feed</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Update Frequency</div>
                            <div class="info-value">30 seconds</div>
                        </div>
                    </div>
                </div>

                <div style="text-align: center;">
                    <a href="fed-rate.json" target="_blank" class="json-link">
                        <span>üìÑ</span>
                        <span>View JSON Data Source</span>
                    </a>
                </div>

                <div class="refresh-info">
                    Auto-refreshes every 30 seconds
                    <div class="last-update">
                        <span>‚è±Ô∏è</span>
                        <span id="refreshTimer">Next update in 30s</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const JSON_URL = 'fed-rate.json';
        const REFRESH_INTERVAL = 30000; // 30 seconds
        const BASELINE_RATE = 4.50;
        const BASELINE_DATE = '2025-07-19T09:00:00Z';
        
        let refreshCountdown = 30;
        let countdownInterval;

        // Fetch and display Fed rate data
        async function fetchFedRateData() {
            try {
                // Add cache-busting parameter to ensure fresh data
                const response = await fetch(`${JSON_URL}?t=${Date.now()}`);
                
                if (!response.ok) {
                    throw new Error('Failed to fetch data');
                }
                
                const data = await response.json();
                updateDisplay(data);
                
                // Hide loading and error, show content
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').style.display = 'none';
                document.getElementById('rateContainer').style.display = 'block';
                
            } catch (error) {
                console.error('Error fetching Fed rate data:', error);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').style.display = 'block';
                document.getElementById('rateContainer').style.display = 'none';
            }
        }

        // Update the display with fetched data
        function updateDisplay(data) {
            // Current rate
            const currentRate = parseFloat(data.current_rate) || BASELINE_RATE;
            document.getElementById('currentRate').textContent = currentRate.toFixed(2);
            
            // Previous rate
            const previousRate = parseFloat(data.previous_rate) || BASELINE_RATE;
            document.getElementById('previousRate').textContent = previousRate.toFixed(2);
            
            // Timestamps
            const currentDate = data.effective_date || BASELINE_DATE;
            const previousDate = data.previous_date || BASELINE_DATE;
            
            document.getElementById('currentTimestamp').innerHTML = formatTimestamp(currentDate);
            document.getElementById('previousTimestamp').innerHTML = formatTimestamp(previousDate);
            
            // Calculate changes
            const bpsChange = Math.round((currentRate - previousRate) * 100);
            const pctChange = previousRate !== 0 ? ((currentRate - previousRate) / previousRate * 100) : 0;
            
            // Update change indicators
            updateChangeIndicators(bpsChange, pctChange);
            
            // Calculate time since change
            const timeDiff = calculateTimeDifference(previousDate, currentDate);
            document.getElementById('timeSinceChange').textContent = timeDiff;
            
            // Update direction
            updateDirection(bpsChange);
            
            // Update history if available
            if (data.rate_history && data.rate_history.length > 0) {
                updateHistory(data.rate_history);
            }
            
            // Last update time
            const now = new Date();
            document.getElementById('lastUpdate').textContent = formatTime(now);
            
            // Reset countdown
            refreshCountdown = 30;
        }

        // Update change indicators
        function updateChangeIndicators(bpsChange, pctChange) {
            const bpsElement = document.getElementById('bpsChange');
            const pctElement = document.getElementById('pctChange');
            const changeIndicator = document.getElementById('changeIndicator');
            const changeArrow = document.getElementById('changeArrow');
            const changeText = document.getElementById('changeText');
            
            // Format BPS change
            if (bpsChange > 0) {
                bpsElement.textContent = `+${bpsChange} bps`;
                bpsElement.className = 'change-value positive';
                pctElement.textContent = `+${pctChange.toFixed(2)}%`;
                pctElement.className = 'change-value positive';
                changeIndicator.className = 'change-indicator increase';
                changeArrow.textContent = '‚Üë';
                changeText.textContent = `+${bpsChange} bps`;
            } else if (bpsChange < 0) {
                bpsElement.textContent = `${bpsChange} bps`;
                bpsElement.className = 'change-value negative';
                pctElement.textContent = `${pctChange.toFixed(2)}%`;
                pctElement.className = 'change-value negative';
                changeIndicator.className = 'change-indicator decrease';
                changeArrow.textContent = '‚Üì';
                changeText.textContent = `${bpsChange} bps`;
            } else {
                bpsElement.textContent = '0 bps';
                bpsElement.className = 'change-value neutral';
                pctElement.textContent = '0.00%';
                pctElement.className = 'change-value neutral';
                changeIndicator.className = 'change-indicator unchanged';
                changeArrow.textContent = '‚Üí';
                changeText.textContent = 'Unchanged';
            }
        }

        // Update direction indicator
        function updateDirection(bpsChange) {
            const directionElement = document.getElementById('direction');
            if (bpsChange > 0) {
                directionElement.textContent = 'üìà Increasing';
                directionElement.className = 'change-value positive';
            } else if (bpsChange < 0) {
                directionElement.textContent = 'üìâ Decreasing';
                directionElement.className = 'change-value negative';
            } else {
                directionElement.textContent = '‚û°Ô∏è Stable';
                directionElement.className = 'change-value neutral';
            }
        }

        // Update history display
        function updateHistory(history) {
            const historySection = document.getElementById('historySection');
            const historyList = document.getElementById('historyList');
            
            if (history.length > 1) {
                historySection.style.display = 'block';
                historyList.innerHTML = '';
                
                // Show last 5 entries
                const recentHistory = history.slice(-5).reverse();
                
                recentHistory.forEach((item, index) => {
                    const historyItem = document.createElement('div');
                    historyItem.className = 'history-item';
                    
                    const changeClass = item.change_bps > 0 ? 'positive' : item.change_bps < 0 ? 'negative' : 'neutral';
                    const changeSymbol = item.change_bps > 0 ? '+' : '';
                    
                    historyItem.innerHTML = `
                        <div class="history-date">${formatTimestamp(item.date)}</div>
                        <div class="history-rate">${parseFloat(item.rate).toFixed(2)}%</div>
                        <div class="history-change ${changeClass}">${changeSymbol}${item.change_bps} bps</div>
                    `;
                    
                    historyList.appendChild(historyItem);
                });
            }
        }

        // Format timestamp for display
        function formatTimestamp(dateString) {
            try {
                const date = new Date(dateString);
                const formattedDate = date.toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'short', 
                    day: 'numeric' 
                });
                const formattedTime = date.toLocaleTimeString('en-US', { 
                    hour: '2-digit', 
                    minute: '2-digit'
                });
                return `${formattedDate}<br><small>${formattedTime}</small>`;
            } catch {
                return dateString;
            }
        }

        // Format time for display
        function formatTime(date) {
            return date.toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit', 
                second: '2-digit' 
            });
        }

        // Calculate time difference
        function calculateTimeDifference(fromDate, toDate) {
            try {
                const from = new Date(fromDate);
                const to = new Date(toDate);
                const diff = Math.abs(to - from);
                
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                
                if (days > 0) {
                    return `${days} day${days > 1 ? 's' : ''}, ${hours}h`;
                } else if (hours > 0) {
                    return `${hours} hour${hours > 1 ? 's' : ''}, ${minutes}m`;
                } else if (minutes > 0) {
                    return `${minutes} minute${minutes > 1 ? 's' : ''}`;
                } else {
                    return 'Just now';
                }
            } catch {
                return '--';
            }
        }

        // Update countdown timer
        function updateCountdown() {
            refreshCountdown--;
            if (refreshCountdown <= 0) {
                refreshCountdown = 30;
                fetchFedRateData();
            }
            document.getElementById('refreshTimer').textContent = `Next update in ${refreshCountdown}s`;
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            // Initial fetch
            fetchFedRateData();
            
            // Set up auto-refresh
            setInterval(fetchFedRateData, REFRESH_INTERVAL);
            
            // Set up countdown timer
            countdownInterval = setInterval(updateCountdown, 1000);
        });

        // Refresh on visibility change (when tab becomes active)
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden) {
                fetchFedRateData();
                refreshCountdown = 30;
            }
        });
    </script>
</body>
</html>
